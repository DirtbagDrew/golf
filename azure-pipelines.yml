# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: CmdLine@2
  inputs:
    script: |
      sudo apt install ruby ruby-dev
      export LC_ALL=en_US.UTF-8
      export LANG=en_US.UTF-8
      sudo gem install fastlane
  displayName: 'install fastlane'
- task: CmdLine@2
  inputs:
    script: |
      fastlane init
    workingDirectory: '$(System.DefaultWorkingDirectory)/android'
  displayName: 'initalize android project'
- task: CmdLine@2
  inputs:
    script: flutter build apk --release;
  displayName: 'build android project'
- task: CmdLine@2
  inputs:
    script: flutter build ios --release --no-codesign.
  displayName: 'Build ios project'
- task: CmdLine@2
  inputs:
    script: |
      fastlane init
    workingDirectory: '$(System.DefaultWorkingDirectory)/android'
  displayName: 'initalize android project'
- task: CmdLine@2
  inputs:
    script: |
      fastlane init
    workingDirectory: '$(System.DefaultWorkingDirectory)/ios'
  displayName: 'initalize ios project'